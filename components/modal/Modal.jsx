/* eslint-disable jsx-a11y/no-static-element-interactions */
import React, { useEffect, useRef, useState } from "react";
import popStyles from "./style.module.css";
import RavenBlack from "../../../../../assets/raven-black-logo";
import ravenSuccess from "../../../../../assets/raven-success.png";
import { ButtonPrimary } from "../../../../../components/buttons/ButtonReuse";
import { useDispatch, useSelector } from "react-redux";
import { shareInvoice } from "../../../../../redux/invoice";
import { ThreeDots } from "react-loader-spinner";

function Modal(props) {
  const [show, setShow] = useState(false);
  const { loading } = useSelector((state) => state.billPayment);

  const closeHandler = () => {
    setShow(false);
    props.onClose(false);
  };

  const [isCopied, setIsCopied] = useState("Tap to Copy");
  const [email, setEmail] = useState();
  const copyLink = () => {
    navigator.clipboard.writeText(props.link);
    setIsCopied("Copied");
  };

  const poweredBy = (
    <svg
      width="99"
      height="14"
      viewBox="0 0 99 14"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M0.558536 11L1.82574 3.02343H5.02768C5.91019 3.02343 6.55134 3.24217 6.95111 3.67966C7.35842 4.1096 7.49796 4.70549 7.36974 5.46731C7.30185 5.91989 7.14345 6.30834 6.89454 6.63269C6.64562 6.95703 6.31751 7.20594 5.91019 7.37943C5.50288 7.54537 5.02391 7.62834 4.47328 7.62834H2.14254L1.61076 11H0.558536ZM2.27831 6.76846H4.42802C4.98619 6.76846 5.42368 6.65531 5.74048 6.42903C6.06482 6.1952 6.26471 5.84823 6.34014 5.38811C6.42311 4.89029 6.34014 4.51691 6.09122 4.268C5.84231 4.01154 5.43499 3.88331 4.86928 3.88331H2.73088L2.27831 6.76846ZM9.63047 11.1018C9.05721 11.1018 8.57447 10.9811 8.18224 10.7398C7.79756 10.4984 7.52601 10.1477 7.36761 9.68754C7.21676 9.21989 7.19036 8.65794 7.28841 8.00171C7.38647 7.39829 7.57881 6.88914 7.86544 6.47429C8.15207 6.05189 8.50659 5.73509 8.92899 5.52389C9.35893 5.31269 9.8379 5.20709 10.3659 5.20709C10.9542 5.20709 11.4408 5.32777 11.8254 5.56914C12.2101 5.81051 12.4817 6.16503 12.6401 6.63269C12.7985 7.0928 12.8249 7.6472 12.7193 8.29589C12.6212 8.90686 12.4289 9.41977 12.1422 9.83463C11.8556 10.2495 11.4973 10.5663 11.0674 10.785C10.6374 10.9962 10.1585 11.1018 9.63047 11.1018ZM9.69836 10.2872C10.2037 10.2872 10.6337 10.1099 10.9882 9.75543C11.3502 9.39337 11.5878 8.86914 11.701 8.18274C11.8141 7.46617 11.7387 6.93063 11.4747 6.57611C11.2182 6.21406 10.826 6.03303 10.298 6.03303C9.79264 6.03303 9.3627 6.21029 9.00819 6.5648C8.66121 6.91931 8.43116 7.436 8.31801 8.11486C8.20487 8.83897 8.27276 9.38206 8.52167 9.74411C8.77059 10.1062 9.16281 10.2872 9.69836 10.2872ZM14.6694 11L13.4361 5.30891H14.4771L15.4275 10.1854H15.1333L17.679 5.30891H18.5163L19.4893 10.1854H19.2064L21.7069 5.30891H22.7704L19.7382 11H18.7652L17.7469 6.04434H18.2447L15.6537 11H14.6694ZM25.172 11.1018C24.5308 11.1018 24.0028 10.9736 23.588 10.7171C23.1731 10.4607 22.8789 10.0986 22.7055 9.63097C22.5395 9.15577 22.5056 8.60137 22.6036 7.96777C22.6941 7.38697 22.8752 6.89291 23.1467 6.4856C23.4183 6.07074 23.7652 5.75394 24.1876 5.5352C24.61 5.31646 25.089 5.20709 25.6245 5.20709C26.1525 5.20709 26.5863 5.324 26.9257 5.55783C27.2727 5.78411 27.5178 6.10091 27.6611 6.50823C27.812 6.91554 27.8459 7.38697 27.7629 7.92251L27.7064 8.26194H23.3617L23.4522 7.65097H27.1067L26.9031 7.80937C26.9936 7.21349 26.9257 6.75714 26.6994 6.44034C26.4731 6.116 26.096 5.95383 25.568 5.95383C25.1908 5.95383 24.8627 6.04057 24.5836 6.21406C24.3121 6.38 24.0933 6.61006 23.9274 6.90423C23.7615 7.19086 23.6559 7.52274 23.6106 7.89989L23.5653 8.18274C23.4748 8.85406 23.5729 9.37451 23.8595 9.74411C24.1461 10.1062 24.6213 10.2872 25.2851 10.2872C25.6019 10.2872 25.9149 10.2382 26.2242 10.1401C26.5335 10.0421 26.8239 9.87989 27.0954 9.6536L27.4348 10.3664C27.1331 10.6002 26.7861 10.7813 26.3939 10.9095C26.0017 11.0377 25.5944 11.1018 25.172 11.1018ZM28.1581 11L28.8369 6.70057C28.8746 6.47429 28.9048 6.24423 28.9274 6.0104C28.9576 5.76903 28.9765 5.5352 28.984 5.30891H29.9797L29.8891 6.73451L29.6968 6.74583C29.825 6.39886 29.9985 6.11223 30.2173 5.88594C30.436 5.65211 30.6811 5.4824 30.9527 5.3768C31.2318 5.26366 31.5184 5.20709 31.8126 5.20709C31.9106 5.20709 32.0049 5.21086 32.0954 5.2184C32.1859 5.22594 32.2727 5.24103 32.3557 5.26366L32.1859 6.18011C32.0879 6.1424 31.9898 6.11977 31.8918 6.11223C31.7937 6.09714 31.6806 6.0896 31.5523 6.0896C31.2205 6.0896 30.9263 6.16126 30.6698 6.30457C30.4134 6.44789 30.2022 6.644 30.0362 6.89291C29.8703 7.13429 29.7647 7.4096 29.7194 7.71886L29.1877 11H28.1581ZM34.5425 11.1018C33.9014 11.1018 33.3734 10.9736 32.9585 10.7171C32.5436 10.4607 32.2495 10.0986 32.076 9.63097C31.91 9.15577 31.8761 8.60137 31.9742 7.96777C32.0647 7.38697 32.2457 6.89291 32.5172 6.4856C32.7888 6.07074 33.1358 5.75394 33.5582 5.5352C33.9806 5.31646 34.4595 5.20709 34.9951 5.20709C35.5231 5.20709 35.9568 5.324 36.2962 5.55783C36.6432 5.78411 36.8883 6.10091 37.0316 6.50823C37.1825 6.91554 37.2164 7.38697 37.1335 7.92251L37.0769 8.26194H32.7322L32.8227 7.65097H36.4772L36.2736 7.80937C36.3641 7.21349 36.2962 6.75714 36.0699 6.44034C35.8436 6.116 35.4665 5.95383 34.9385 5.95383C34.5614 5.95383 34.2332 6.04057 33.9542 6.21406C33.6826 6.38 33.4639 6.61006 33.2979 6.90423C33.132 7.19086 33.0264 7.52274 32.9811 7.89989L32.9359 8.18274C32.8454 8.85406 32.9434 9.37451 33.23 9.74411C33.5167 10.1062 33.9919 10.2872 34.6556 10.2872C34.9724 10.2872 35.2855 10.2382 35.5947 10.1401C35.904 10.0421 36.1944 9.87989 36.4659 9.6536L36.8054 10.3664C36.5036 10.6002 36.1567 10.7813 35.7644 10.9095C35.3722 11.0377 34.9649 11.1018 34.5425 11.1018ZM39.8028 11.1018C39.2823 11.1018 38.8448 10.9811 38.4903 10.7398C38.1358 10.4909 37.8869 10.1363 37.7436 9.67623C37.6002 9.20857 37.5776 8.6504 37.6757 8.00171C37.8265 7.08903 38.166 6.39509 38.694 5.91989C39.222 5.44469 39.8556 5.20709 40.5948 5.20709C41.0926 5.20709 41.5074 5.33154 41.8393 5.58046C42.1788 5.82937 42.3824 6.17257 42.4503 6.61006H42.3372L42.9594 2.67268H43.989L42.6653 11H41.647L41.8506 9.67623H42.0204C41.8242 10.1213 41.5376 10.472 41.1605 10.7285C40.7833 10.9774 40.3308 11.1018 39.8028 11.1018ZM40.0969 10.2872C40.6023 10.2872 41.036 10.1099 41.3981 9.75543C41.7601 9.39337 41.9977 8.86914 42.1109 8.18274C42.224 7.46617 42.1486 6.93063 41.8846 6.57611C41.6281 6.21406 41.2321 6.03303 40.6966 6.03303C40.1912 6.03303 39.7613 6.21029 39.4068 6.5648C39.0522 6.91931 38.8184 7.436 38.7053 8.11486C38.5921 8.83897 38.66 9.38206 38.9089 9.74411C39.1654 10.1062 39.5614 10.2872 40.0969 10.2872ZM49.4554 11.1018C48.9576 11.1018 48.539 10.9774 48.1995 10.7285C47.8677 10.472 47.664 10.1288 47.5886 9.69886L47.7017 9.67623L47.4981 11H46.4685L47.7922 2.67268H48.8218L48.1995 6.61006L48.0185 6.62137C48.2222 6.18389 48.5088 5.84069 48.8784 5.59177C49.2555 5.33531 49.7081 5.20709 50.2361 5.20709C50.7641 5.20709 51.2054 5.33154 51.5599 5.58046C51.9144 5.82183 52.1633 6.17634 52.3066 6.644C52.4575 7.10411 52.4801 7.65474 52.3745 8.29589C52.2237 9.20857 51.8842 9.90629 51.3562 10.389C50.8282 10.8642 50.1946 11.1018 49.4554 11.1018ZM49.3423 10.2872C49.8552 10.2872 50.2889 10.1099 50.6434 9.75543C50.9979 9.39337 51.2318 8.86914 51.3449 8.18274C51.4581 7.46617 51.3864 6.93063 51.1299 6.57611C50.881 6.21406 50.485 6.03303 49.9419 6.03303C49.4441 6.03303 49.0104 6.21029 48.6408 6.5648C48.2787 6.91931 48.0411 7.436 47.928 8.11486C47.8224 8.83897 47.8978 9.38206 48.1543 9.74411C48.4183 10.1062 48.8143 10.2872 49.3423 10.2872ZM52.1896 13.5683L52.0199 12.7311C52.3895 12.6481 52.6987 12.5501 52.9477 12.4369C53.2041 12.3313 53.4266 12.1918 53.6152 12.0183C53.8038 11.8448 53.9773 11.6261 54.1357 11.3621L54.5317 10.6832L54.4751 11.1131L52.9137 5.30891H53.9886L55.2105 10.1854H54.905L57.6544 5.30891H58.7632L55.1766 11.4413C54.9578 11.8109 54.7353 12.1201 54.509 12.369C54.2827 12.6179 54.0489 12.8216 53.8075 12.98C53.5737 13.1384 53.3248 13.2629 53.0608 13.3534C52.7968 13.4439 52.5064 13.5155 52.1896 13.5683Z"
        fill="#333333"
      />
      <path
        d="M66.773 2.51173H62.6047L61.6189 9.46592L61.5977 9.60853C61.5977 9.65231 61.5977 9.69735 61.5977 9.74113C61.5968 9.93158 61.6336 10.1203 61.7058 10.2966C61.778 10.4728 61.8842 10.6331 62.0184 10.7682C62.1526 10.9033 62.3122 11.0107 62.4879 11.0841C62.6636 11.1575 62.8521 11.1955 63.0426 11.196H63.7594L63.7881 10.9884L64.1046 8.76412L64.2297 7.85341H65.2017L65.9974 10.1164L66.0712 10.3253C66.1765 10.5666 66.3456 10.7746 66.5602 10.9269C66.7749 11.0792 67.0271 11.1701 67.2896 11.1898H69.1248L68.7645 10.2403L68.0928 8.47264L67.6974 7.44308C68.0972 7.20432 68.436 6.87583 68.687 6.48358C68.938 6.09824 69.1019 5.66279 69.1673 5.20759C69.2724 4.43782 69.0965 3.79565 68.6394 3.28108C68.1824 2.76651 67.5603 2.51006 66.773 2.51173ZM64.4399 6.40102L64.7802 3.95786H65.9974C66.1256 3.95012 66.2536 3.97705 66.3678 4.03582C66.482 4.09459 66.5783 4.18304 66.6466 4.29187C66.788 4.51579 66.8318 4.83354 66.7717 5.24637C66.6666 6.01614 66.2938 6.40102 65.6533 6.40102H64.4399Z"
        fill="#333333"
      />
      <path
        d="M74.6778 5.36771C74.4685 5.10687 74.2012 4.89853 73.8971 4.75931C73.593 4.62009 73.2606 4.55384 72.9264 4.56584C72.7431 4.56632 72.5602 4.58264 72.3797 4.61462C72.1774 4.65145 71.9783 4.70415 71.7843 4.77225C71.571 4.8467 71.3656 4.94225 71.1713 5.05747C70.9598 5.18454 70.7638 5.33566 70.5871 5.50782C70.1748 5.90035 69.8625 6.38593 69.6764 6.92393C69.5544 7.25356 69.4705 7.59605 69.4262 7.94473C69.3517 8.3957 69.3555 8.85612 69.4374 9.30579C69.4952 9.65312 69.6257 9.98435 69.8202 10.2778C69.9939 10.52 70.2126 10.7265 70.4645 10.8858C70.695 11.0369 70.9485 11.1497 71.2151 11.2198C71.4572 11.2808 71.706 11.3115 71.9557 11.3111C72.7663 11.3111 73.451 10.91 74.0098 10.1077L73.8521 11.196H76.1727L77.0972 4.69093H74.7754L74.6778 5.36771ZM74.3913 7.37678L74.3563 7.62698C74.2706 8.27259 74.0218 8.8857 73.6332 9.40837C73.5744 9.48593 73.5156 9.55724 73.4568 9.62104C73.1941 9.90877 72.9168 10.0526 72.6249 10.0526C72.268 10.0526 72.0128 9.85581 71.8593 9.46217C71.7059 9.06852 71.6734 8.5723 71.7618 7.9735C71.851 7.32549 72.0432 6.80717 72.3385 6.41853C72.6337 6.0299 72.9673 5.83516 73.3392 5.83433C73.4747 5.83577 73.6081 5.86687 73.7302 5.92545C73.8524 5.98402 73.9601 6.06863 74.046 6.17334C74.1868 6.33727 74.2905 6.52965 74.3501 6.73735C74.4097 6.94505 74.4238 7.16316 74.3913 7.37678Z"
        fill="#333333"
      />
      <path
        d="M90.6687 5.14167C90.4434 4.9484 90.1781 4.80742 89.8918 4.72885C89.5034 4.6137 89.0997 4.55844 88.6946 4.56497C87.7215 4.55332 86.7766 4.89211 86.0325 5.51947C85.282 6.12272 84.7801 6.98139 84.6227 7.93136C84.4651 8.86375 84.6919 9.65979 85.3032 10.3195C85.9145 10.9792 86.7247 11.3094 87.7339 11.3102C88.3683 11.3189 88.9955 11.1752 89.5628 10.8912C90.0856 10.6367 90.521 10.2326 90.8138 9.73026L90.1945 9.24363C90.0187 9.41747 89.825 9.5722 89.6166 9.70524C89.259 9.93248 88.8431 10.0511 88.4194 10.0468C87.3352 10.0468 86.8265 9.48841 86.8932 8.3717C86.8954 8.34447 86.9076 8.31902 86.9275 8.3003C86.9474 8.28157 86.9735 8.27091 87.0008 8.27037C87.9696 8.2714 88.9269 8.06047 89.8055 7.65239C90.5561 7.31879 90.9935 6.81215 91.1178 6.13245C91.1403 5.96705 91.1152 5.79864 91.0452 5.64707C90.9551 5.45492 90.827 5.283 90.6687 5.14167ZM89.3139 6.48522C89.2004 7.0048 88.585 7.31671 87.4674 7.42096L87.0546 7.45598C87.1646 7.02376 87.3697 6.62157 87.6551 6.27881C87.7613 6.14231 87.8966 6.0311 88.051 5.95322C88.2055 5.87534 88.3753 5.83272 88.5483 5.82846C88.6548 5.82785 88.7611 5.84003 88.8648 5.86474C88.9562 5.88718 89.0439 5.92301 89.125 5.97107C89.1798 6.00116 89.2266 6.04408 89.2613 6.09617C89.2958 6.15413 89.3183 6.21847 89.3273 6.28533C89.3364 6.35219 89.3318 6.42018 89.3139 6.48522Z"
        fill="#333333"
      />
      <path
        d="M96.4604 4.56456C96.2012 4.56225 95.9431 4.59894 95.6948 4.67339C95.4423 4.75663 95.2076 4.88647 95.003 5.05619C94.755 5.26109 94.538 5.50085 94.3587 5.768L94.5201 4.68965H92.1946L91.6591 8.46511L91.3289 10.7832L91.2676 11.1947H92.3334C92.6772 11.1963 93.0103 11.0756 93.2734 10.8543C93.5364 10.6329 93.7123 10.3253 93.7695 9.9863L93.7808 9.90373L94.1198 7.52687C94.3336 7.06877 94.6052 6.63995 94.9279 6.25087C95.1781 5.96815 95.4371 5.82554 95.6885 5.82554C96.1739 5.82554 96.352 6.29549 96.2227 7.23539L95.9262 9.32953L95.8662 9.75487C95.8668 10.1151 96.0015 10.4621 96.2441 10.7283C96.4868 10.9946 96.8199 11.1608 97.1785 11.1947H97.9803L98.0041 11.0221L98.3281 8.72531L98.5508 7.14783C98.6642 6.36972 98.5287 5.74423 98.1442 5.27136C97.7597 4.79849 97.1985 4.56289 96.4604 4.56456Z"
        fill="#333333"
      />
      <path
        d="M83.1351 4.69141L81.1686 8.69454L81.0923 8.31924C81.0182 8.30767 80.9433 8.30182 80.8684 8.30173C80.4945 8.30045 80.1346 8.44391 79.8641 8.70204C79.5936 8.96018 79.4335 9.31297 79.4174 9.68651C79.4012 10.06 79.5302 10.4253 79.7774 10.7059C80.0245 10.9864 80.3707 11.1605 80.7433 11.1915H81.0022C81.2346 11.1698 81.4584 11.0923 81.6544 10.9656C81.8505 10.8388 82.013 10.6665 82.1281 10.4634L82.1944 10.3308L85.0316 4.69141H83.1351Z"
        fill="#333333"
      />
      <path
        d="M79.1782 4.69141H77.8984L78.0235 5.26435L78.4927 7.41354C78.6866 7.51781 78.9017 7.57648 79.1217 7.58507C79.3417 7.59366 79.5607 7.55195 79.7622 7.46311C79.9636 7.37427 80.1422 7.24065 80.2842 7.07241C80.4262 6.90418 80.528 6.70576 80.5817 6.49226C80.6355 6.27876 80.6398 6.05581 80.5945 5.84037C80.5491 5.62494 80.4551 5.4227 80.3198 5.24905C80.1844 5.07539 80.0113 4.9349 79.8134 4.83827C79.6156 4.74164 79.3984 4.69141 79.1782 4.69141Z"
        fill="#333333"
      />
    </svg>
  );

  const dispatch = useDispatch();

  useEffect(() => {
    setShow(props.show);
  }, [props.show]);

  const share = async (e) => {
    const payload = {
      email: email,
      invoice_id: String(props.id),
    };
    const data = await dispatch(shareInvoice(payload));
    if (data.payload.status === "success") {
      setShow(false);
    }
  };
  return (
    <>
      <div
        style={{
          visibility: show ? "visible" : "hidden",
          opacity: show ? "1" : "0",
        }}
        className={popStyles.overlay}
      >
        <div onClick={() => closeHandler()} className={popStyles.close_div}>
          r
        </div>

        <div className={popStyles.popup}>
          <div className={popStyles.modal_title}>
            <h3>Share this Invoice</h3>
            <p>
              Either copy the invoice link or attach this invoice as a mail and
              send it to your
              <br />
              customer, to get your payment faster and easier.
            </p>
          </div>

          <div className={popStyles.reciever_email}>
            <span>Customer Email Address</span>
            <div>
              <div>
                <input
                  type="text"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder="Enter an Email"
                />
              </div>
              <div className={popStyles.share_btn}>
                <ButtonPrimary
                  action={() => share()}
                  btnStyle={popStyles.share_btn}
                  // label="Share Invoice"
                >
                  {!loading ? (
                    "Share Invoice"
                  ) : (
                    <div
                      // style={{ padding: "0.7rem" }}
                      className="load-wrap"
                    >
                      <ThreeDots
                        height="15"
                        width="100"
                        radius="9"
                        color="#ffffff"
                        ariaLabel="three-dots-loading"
                        wrapperStyle={{}}
                        wrapperClassName=""
                        visible={true}
                      />
                    </div>
                  )}
                </ButtonPrimary>
              </div>
            </div>
          </div>

          <div className={popStyles.copy_url}>
            <small>Share a clickable link</small>
            <div className={popStyles.link}>
              <p>business.ravenbank.com/invoices/58503-5968gr/fg....</p>
              <span>COPY LINK</span>
            </div>
          </div>

          <div className={popStyles.footer}>{poweredBy}</div>
        </div>
      </div>
    </>
  );
}

export default Modal;
